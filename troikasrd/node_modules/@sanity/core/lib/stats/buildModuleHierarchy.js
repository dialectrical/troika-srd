"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

function buildHierarchy(modules) {
  var maxDepth = 1;
  var root = {
    children: [],
    name: 'root'
  };
  modules.forEach(module => {
    var mod = {
      displayName: normalizeName(module.name),
      sanityRole: getSanityRole(module.name),
      fullName: module.name,
      size: module.size
    };
    var depth = mod.fullName.split('/').length - 1;

    if (depth > maxDepth) {
      maxDepth = depth;
    }

    var fileName = mod.fullName;
    var beginning = mod.fullName.slice(0, 2);

    if (beginning === './') {
      fileName = fileName.slice(2);
    }

    getFile(mod, fileName, root);
  });
  root.maxDepth = maxDepth;
  return root;
}

function getFile(module, fileName, parentTree) {
  var charIndex = fileName.indexOf('/');

  if (charIndex === -1) {
    module.name = fileName;
    parentTree.children.push(module);
    return;
  }

  var folder = fileName.slice(0, charIndex);

  if (folder === '~') {
    folder = 'node_modules';
  }

  var childFolder = parentTree.children.find(item => item.name === folder);

  if (!childFolder) {
    childFolder = {
      name: folder,
      children: []
    };
    parentTree.children.push(childFolder);
  }

  getFile(module, fileName.slice(charIndex + 1), childFolder);
}

function normalizeName(name) {
  return name.replace(/\?sanityRole=.*/, '');
}

function getSanityRole(name) {
  var match = name.match(/.*?\?sanityRole=(.*?)(&|$)/);
  return match && decodeURIComponent(match[1]);
}

var _default = buildHierarchy;
exports.default = _default;