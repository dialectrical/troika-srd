"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var createClient_1 = require("./createClient");
var createConnect_1 = require("./createConnect");
var operators_1 = require("./operators");
var operators_2 = require("rxjs/operators");
var rxjs_1 = require("rxjs");
var connect = createConnect_1.createConnect(function (url, protocols) {
    return new window.WebSocket(url, protocols);
});
var id = function (arg) { return arg; };
function fromUrl(url, options) {
    if (options === void 0) { options = {}; }
    return createClient_1.createClient(connect(url).pipe(options.timeout
        ? operators_1.timeoutFirstWith(options.timeout, rxjs_1.throwError(new Error("Timeout after " + options.timeout + " while establishing WebSockets connection")))
        : id, operators_2.shareReplay({ refCount: true }), operators_2.takeUntil(rxjs_1.fromEvent(window, 'beforeunload'))));
}
exports.fromUrl = fromUrl;
function fromSanityClient(client) {
    var dataset = client.config().dataset;
    return fromUrl(client.getUrl("/socket/" + dataset).replace(/^http/, 'ws'));
}
exports.fromSanityClient = fromSanityClient;
