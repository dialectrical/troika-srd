"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ConfirmUnpublish = void 0;

var _components = require("@sanity/base/components");

var _icons = require("@sanity/icons");

var _ui = require("@sanity/ui");

var _react = _interopRequireDefault(require("react"));

var _enhanceWithReferringDocuments = require("./enhanceWithReferringDocuments");

var _DocTitle = require("./DocTitle");

var _ReferringDocumentsList = require("./ReferringDocumentsList");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ConfirmUnpublish = (0, _enhanceWithReferringDocuments.enhanceWithReferringDocuments)(function ConfirmUnpublish(props) {
  var isCheckingReferringDocuments = props.isCheckingReferringDocuments,
      referringDocuments = props.referringDocuments,
      draft = props.draft,
      published = props.published,
      onCancel = props.onCancel,
      onConfirm = props.onConfirm;
  var hasReferringDocuments = referringDocuments.length > 0;
  var canContinue = !isCheckingReferringDocuments;
  var title = isCheckingReferringDocuments ? 'Checkingâ€¦' : 'Confirm unpublish';
  var value = draft || published;
  var docTitle = value ? /*#__PURE__*/_react.default.createElement(_DocTitle.DocTitle, {
    document: value
  }) : /*#__PURE__*/_react.default.createElement("em", null, "No document");

  var footer = /*#__PURE__*/_react.default.createElement(_ui.Grid, {
    columns: canContinue ? 2 : 1,
    gap: 2,
    paddingX: 4,
    paddingY: 3
  }, /*#__PURE__*/_react.default.createElement(_ui.Button, {
    mode: "ghost",
    onClick: onCancel,
    text: "Cancel"
  }), canContinue && /*#__PURE__*/_react.default.createElement(_ui.Button, {
    onClick: onConfirm,
    text: hasReferringDocuments ? 'Try to unpublish anyway' : 'Unpublish now',
    tone: "critical"
  }));

  return /*#__PURE__*/_react.default.createElement(_components.LegacyLayerProvider, {
    zOffset: "fullscreen"
  }, /*#__PURE__*/_react.default.createElement(_ui.Dialog, {
    footer: footer,
    id: "confirm-unpublish",
    header: title,
    onClickOutside: onCancel,
    onClose: onCancel,
    width: 1
  }, /*#__PURE__*/_react.default.createElement(_ui.Box, {
    padding: 4
  }, isCheckingReferringDocuments && /*#__PURE__*/_react.default.createElement(_ui.Flex, {
    align: "center",
    direction: "column"
  }, /*#__PURE__*/_react.default.createElement(_ui.Spinner, {
    muted: true
  }), /*#__PURE__*/_react.default.createElement(_ui.Box, {
    marginTop: 3
  }, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    align: "center",
    muted: true,
    size: 1
  }, "Looking for referring documents\u2026"))), hasReferringDocuments && /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_ui.Card, {
    padding: 3,
    radius: 2,
    tone: "caution"
  }, /*#__PURE__*/_react.default.createElement(_ui.Flex, null, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    size: 1
  }, /*#__PURE__*/_react.default.createElement(_icons.WarningOutlineIcon, null)), /*#__PURE__*/_react.default.createElement(_ui.Box, {
    flex: 1,
    marginLeft: 3
  }, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    size: 1
  }, "Warning: Found", ' ', referringDocuments.length === 1 ? /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, "a document") : /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, referringDocuments.length, " documents"), ' ', "that refers to \u201C", docTitle, "\u201D")))), /*#__PURE__*/_react.default.createElement(_ui.Box, {
    marginY: 4
  }, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    as: "p"
  }, "You may not be able to unpublish \u201C", docTitle, "\u201D because the following document", referringDocuments.length !== 1 && /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, "s"), " refers to it:")), /*#__PURE__*/_react.default.createElement(_ReferringDocumentsList.ReferringDocumentsList, {
    documents: referringDocuments
  })), !isCheckingReferringDocuments && !hasReferringDocuments && /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_ui.Card, {
    padding: 3,
    radius: 2,
    tone: "caution"
  }, /*#__PURE__*/_react.default.createElement(_ui.Flex, null, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    size: 1
  }, /*#__PURE__*/_react.default.createElement(_icons.WarningOutlineIcon, null)), /*#__PURE__*/_react.default.createElement(_ui.Box, {
    flex: 1,
    marginLeft: 3
  }, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    size: 1
  }, "If you unpublish this document, it will no longer be available to the public. However, it will not be deleted and can be published again later.")))), /*#__PURE__*/_react.default.createElement(_ui.Box, {
    marginTop: 4
  }, /*#__PURE__*/_react.default.createElement(_ui.Text, {
    as: "p"
  }, "Are you sure you want to unpublish the document ", /*#__PURE__*/_react.default.createElement("strong", null, "\u201C", docTitle, "\u201D"), "?"))))));
});
exports.ConfirmUnpublish = ConfirmUnpublish;