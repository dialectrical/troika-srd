"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getState = getState;
exports.storeState = storeState;

var _isPlainObject = _interopRequireDefault(require("./isPlainObject"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var storageKey = 'sanityVision';
var defaultState = {};
var hasLocalStorage = supportsLocalStorage();
var state = null;

function getState(key, defaultVal) {
  ensureState();
  return typeof state[key] === 'undefined' ? defaultVal : state[key];
}

function storeState(key, value) {
  ensureState();
  state[key] = value;
  localStorage.setItem(storageKey, JSON.stringify(state));
}

function ensureState() {
  if (state === null) {
    state = loadState();
  }
}

function loadState() {
  if (!hasLocalStorage) {
    return defaultState;
  }

  try {
    var stored = JSON.parse(localStorage.getItem(storageKey));
    return (0, _isPlainObject.default)(stored) ? stored : defaultState;
  } catch (err) {
    return defaultState;
  }
}

function supportsLocalStorage() {
  var mod = 'lsCheck';

  try {
    localStorage.setItem(mod, mod);
    localStorage.removeItem(mod);
    return true;
  } catch (err) {
    return false;
  }
}