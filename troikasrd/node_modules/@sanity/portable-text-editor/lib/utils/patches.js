"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.compactPatches = compactPatches;

var _isEqual2 = _interopRequireDefault(require("lodash/isEqual"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Try to compact a set of patches
 *
 */
function compactPatches(patches) {
  // If the last patch is unsetting everything, just do that
  var lastPatch = patches.slice(-1)[0];

  if (lastPatch && lastPatch.type === 'unset' && lastPatch.path.length === 0) {
    return [lastPatch];
  }

  var finalPatches = patches; // Run through the patches and remove any redundant ones.

  finalPatches = finalPatches.filter((patch, index) => {
    if (!patch) {
      return false;
    }

    var nextPatch = finalPatches[index + 1];

    if (nextPatch && nextPatch.type === 'set' && patch.type === 'set' && (0, _isEqual2.default)(patch.path, nextPatch.path)) {
      return false;
    }

    return true;
  });

  if (finalPatches.length !== patches.length) {
    return finalPatches;
  }

  return patches;
}