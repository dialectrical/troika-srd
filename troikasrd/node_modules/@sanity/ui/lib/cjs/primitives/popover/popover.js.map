{
  "version": 3,
  "sources": ["../../../../src/primitives/popover/popover.tsx"],
  "sourcesContent": ["import React, {cloneElement, forwardRef, useCallback, useEffect, useMemo, useState} from 'react'\nimport {usePopper} from 'react-popper'\nimport styled, {css} from 'styled-components'\nimport {EMPTY_RECORD} from '../../constants'\nimport {useForwardedRef} from '../../hooks'\nimport {ThemeColorSchemeKey, useTheme} from '../../theme'\nimport {CardTone, Placement} from '../../types'\nimport {Layer, LayerProps, Portal, useBoundaryElement, usePortal} from '../../utils'\nimport {Card} from '../card'\nimport {ResponsiveWidthStyleProps} from '../container'\nimport {responsiveContainerWidthStyle} from '../container/styles'\nimport {ResponsiveRadiusProps, ResponsiveShadowProps, ResponsiveWidthProps} from '../types'\nimport {PopoverArrow} from './arrow'\nimport {usePopoverModifiers} from './modifiers'\n\n/**\n * @public\n */\nexport interface PopoverProps\n  extends Omit<LayerProps, 'as'>,\n    ResponsiveRadiusProps,\n    ResponsiveShadowProps,\n    ResponsiveWidthProps {\n  /**\n   * @beta\n   */\n  __unstable_margins?: [number, number, number, number]\n  allowedAutoPlacements?: Placement[]\n  arrow?: boolean\n  boundaryElement?: HTMLElement | null\n  children?: React.ReactElement\n  constrainSize?: boolean\n  content?: React.ReactNode\n  disabled?: boolean\n  fallbackPlacements?: Placement[]\n  open?: boolean\n  padding?: number | number[]\n  placement?: Placement\n  portal?: boolean\n  preventOverflow?: boolean\n  referenceElement?: HTMLElement | null\n  matchReferenceWidth?: boolean\n  scheme?: ThemeColorSchemeKey\n  tether?: boolean\n  tetherOffset?: number | ((...args: any[]) => number)\n  tone?: CardTone\n}\n\nconst Root = styled(Layer)<{$preventOverflow?: boolean}>(\n  ({$preventOverflow}) => css`\n    pointer-events: none;\n    display: flex;\n    flex-direction: column;\n    max-width: calc(100% - 16px);\n\n    & > * {\n      min-height: 0;\n    }\n\n    /* Hide the popover when the reference element is out of bounds */\n    ${$preventOverflow &&\n    css`\n      &[data-popper-reference-hidden='true'] {\n        display: none;\n      }\n    `}\n  `\n)\n\nconst PopoverCard = styled(Card)<\n  ResponsiveWidthStyleProps & {\n    $constrainSize?: boolean\n    $preventOverflow?: boolean\n  }\n>(\n  ({$constrainSize}) => css`\n    flex: 1;\n    max-height: ${$constrainSize && '100%'};\n    pointer-events: all;\n\n    && {\n      display: flex;\n    }\n\n    flex-direction: column;\n\n    & > * {\n      min-height: 0;\n    }\n\n    ${responsiveContainerWidthStyle}\n  `\n)\n\n/**\n * @public\n */\nexport const Popover = forwardRef(function Popover(\n  props: PopoverProps &\n    Omit<React.HTMLProps<HTMLDivElement>, 'as' | 'children' | 'content' | 'width'>,\n  ref: React.ForwardedRef<HTMLDivElement>\n) {\n  const boundaryElementContext = useBoundaryElement()\n  const theme = useTheme()\n  const {\n    __unstable_margins: margins,\n    allowedAutoPlacements,\n    arrow = true,\n    boundaryElement: boundaryElementProp = boundaryElementContext.element,\n    children: child,\n    content,\n    constrainSize,\n    disabled,\n    fallbackPlacements,\n    open = false,\n    padding,\n    placement = 'bottom',\n    portal: portalProp = false,\n    preventOverflow,\n    radius = 3,\n    referenceElement: referenceElementProp,\n    matchReferenceWidth,\n    shadow = 3,\n    scheme,\n    style = EMPTY_RECORD,\n    tether,\n    tetherOffset,\n    tone = 'inherit',\n    width = 0,\n    zOffset = theme.sanity.layer?.popover.zOffset,\n    ...restProps\n  } = props\n  const forwardedRef = useForwardedRef(ref)\n  const portal = usePortal()\n  const [referenceElement, setReferenceElement] = useState<HTMLElement | null>(null)\n  const [popperElement, setPopperElement] = useState<HTMLElement | null>(null)\n  const [arrowElement, setArrowElement] = useState<HTMLElement | null>(null)\n  const popperReferenceElement = referenceElementProp || referenceElement\n\n  const modifiers = usePopoverModifiers({\n    allowedAutoPlacements,\n    arrow,\n    arrowElement,\n    boundaryElement: boundaryElementProp || portal.boundaryElement,\n    constrainSize,\n    distance: arrow ? 4 : 0,\n    fallbackPlacements,\n    margins,\n    matchReferenceWidth,\n    open,\n    preventOverflow,\n    skidding: 0,\n    tether,\n    tetherOffset,\n  })\n\n  const popper = usePopper(popperReferenceElement, popperElement, {\n    placement,\n    modifiers,\n  })\n\n  const {attributes, forceUpdate, styles} = popper\n\n  const setRef = useCallback(\n    (el: HTMLElement | null) => {\n      const childRef = (child as any).ref\n\n      setReferenceElement(el)\n\n      if (typeof childRef === 'function') {\n        childRef(el)\n      } else if (childRef) {\n        childRef.current = el\n      }\n    },\n    [child]\n  )\n\n  const setRootRef = useCallback(\n    (el: HTMLDivElement | null) => {\n      setPopperElement(el)\n      forwardedRef.current = el\n    },\n    [forwardedRef]\n  )\n\n  const popoverStyle = useMemo(() => ({...style, ...styles.popper}), [style, styles])\n\n  useEffect(() => {\n    if (forceUpdate) {\n      try {\n        forceUpdate()\n      } catch (_) {\n        // ignore caught error\n      }\n    }\n  }, [content, forceUpdate, open, popperReferenceElement])\n\n  if (disabled) {\n    return child || <></>\n  }\n\n  const node = (\n    <Root\n      data-ui=\"Popover\"\n      {...restProps}\n      $preventOverflow={preventOverflow}\n      ref={setRootRef}\n      style={popoverStyle}\n      zOffset={zOffset}\n      {...attributes.popper}\n    >\n      <PopoverCard\n        $constrainSize={constrainSize}\n        data-ui=\"PopoverCard\"\n        padding={padding}\n        radius={radius}\n        scheme={scheme}\n        shadow={shadow}\n        tone={tone}\n        width={width as any}\n      >\n        {arrow && <PopoverArrow ref={setArrowElement} style={styles.arrow} />}\n        {content}\n      </PopoverCard>\n    </Root>\n  )\n\n  return (\n    <>\n      {child && !referenceElementProp ? cloneElement(child, {ref: setRef}) : child || <></>}\n\n      {open && (\n        <>\n          {portalProp && <Portal>{node}</Portal>}\n\n          {!portalProp && node}\n        </>\n      )}\n    </>\n  )\n})\n"],
  "mappings": "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",
  "names": []
}
