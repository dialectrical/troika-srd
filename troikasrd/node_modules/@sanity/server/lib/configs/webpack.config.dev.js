"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _webpack = _interopRequireDefault(require("webpack"));

var _applyStaticLoaderFix = _interopRequireDefault(require("../util/applyStaticLoaderFix"));

var _webpack2 = _interopRequireDefault(require("./webpack.config"));

var _monorepoAliases = require("./monorepoAliases");

var _getModulePath = require("./getModulePath");

var _applyLocalWebpackConfig = require("./applyLocalWebpackConfig");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = config => {
  var basePath = config.basePath || process.cwd();
  var baseConfig = (0, _webpack2.default)(config);
  var devConfig = Object.assign({}, baseConfig, {
    devtool: 'cheap-module-source-map',
    output: Object.assign({
      pathinfo: true
    }, baseConfig.output),
    entry: Object.assign({}, baseConfig.entry, {
      vendor: [require.resolve('eventsource-polyfill'), require.resolve('../browser/hot-client')].concat(baseConfig.entry.vendor)
    }),
    resolve: {
      alias: Object.assign({}, baseConfig.resolve.alias, {
        'react-dom': (0, _getModulePath.getModulePath)('@hot-loader/react-dom'),
        'webpack-hot-middleware/client': require.resolve('../browser/hot-client')
      }, config.isSanityMonorepo ? (0, _monorepoAliases.getMonorepoAliases)() : {}),
      extensions: baseConfig.resolve.extensions
    },
    plugins: (baseConfig.plugins || []).concat([new _webpack.default.HotModuleReplacementPlugin(), new _webpack.default.NoEmitOnErrorsPlugin()]),
    module: Object.assign({}, baseConfig.module, {
      rules: (0, _applyStaticLoaderFix.default)(baseConfig, config)
    })
  });
  return (0, _applyLocalWebpackConfig.applyLocalWebpackConfig)(devConfig, basePath, 'development');
};

exports.default = _default;