"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loadImage = loadImage;

var _rxjs = require("rxjs");

// http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever
var PROBABLY_THE_TINIEST_GIF_EVER = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

var noop = () => undefined;

function isLocalFile(src) {
  return src.startsWith('blob:');
}

function loadImage(src) {
  return new _rxjs.Observable(observer => {
    var image = document.createElement('img');
    var loaded = false;

    var onload = () => {
      loaded = true;
      observer.next(image);
      observer.complete();
    };

    var onerror = () => {
      observer.error(new Error("Could not load image from ".concat(isLocalFile(src) ? 'local file' : src)));
    };

    image.onload = onload;
    image.onerror = onerror;
    image.src = src;
    return () => {
      image.onload = noop;
      image.onerror = noop;

      if (!loaded) {
        image.src = PROBABLY_THE_TINIEST_GIF_EVER;
      }
    };
  });
}