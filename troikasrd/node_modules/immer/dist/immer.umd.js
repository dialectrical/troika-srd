!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).immer={})}(this,function(e){"use strict";var r,t,n,o="undefined"!=typeof Symbol,a="undefined"!=typeof Map,i="undefined"!=typeof Set,c=o?Symbol("immer-nothing"):((r={})["immer-nothing"]=!0,r),s=o?Symbol("immer-draftable"):"__$immer_draftable",u=o?Symbol("immer-state"):"__$immer_state",f=o?Symbol.iterator:"@@iterator",p=function(e,r){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)};function d(e,r){function t(){this.constructor=e}p(e,r),e.prototype=(t.prototype=r.prototype,new t)}function h(e){return!!e&&!!e[u]}function l(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);return!r||r===Object.prototype}(e)||Array.isArray(e)||!!e[s]||!!e.constructor[s]||w(e)||O(e))}!function(e){e[e.Object=0]="Object",e[e.Array=1]="Array",e[e.Map=2]="Map",e[e.Set=3]="Set"}(t||(t={})),function(e){e[e.ProxyObject=0]="ProxyObject",e[e.ProxyArray=1]="ProxyArray",e[e.ES5Object=2]="ES5Object",e[e.ES5Array=3]="ES5Array",e[e.Map=4]="Map",e[e.Set=5]="Set"}(n||(n={}));var y="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function v(e,r){b(e)===t.Object?y(e).forEach(function(t){return r(t,e[t],e)}):e.forEach(function(t,n){return r(n,t,e)})}function b(e){if(e||S(),e[u])switch(e[u].type){case n.ES5Object:case n.ProxyObject:return t.Object;case n.ES5Array:case n.ProxyArray:return t.Array;case n.Map:return t.Map;case n.Set:return t.Set}return Array.isArray(e)?t.Array:w(e)?t.Map:O(e)?t.Set:t.Object}function m(e,r){return b(e)===t.Map?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function g(e,r){return b(e)===t.Map?e.get(r):e[r]}function P(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function w(e){return a&&e instanceof Map}function O(e){return i&&e instanceof Set}function j(e){return e.copy||e.base}function E(e,r){if(void 0===r&&(r=!1),Array.isArray(e))return e.slice();var t=Object.create(Object.getPrototypeOf(e));return y(e).forEach(function(n){if(n!==u){var o=Object.getOwnPropertyDescriptor(e,n),a=o.value;if(o.get){if(!r)throw new Error("Immer drafts cannot have computed properties");a=o.get.call(e)}o.enumerable?t[n]=a:Object.defineProperty(t,n,{value:a,writable:!0,configurable:!0})}}),t}function x(e,r){if(l(e)&&!h(e)&&!Object.isFrozen(e)){var n=b(e);n===t.Set?e.add=e.clear=e.delete=A:n===t.Map&&(e.set=e.clear=e.delete=A),Object.freeze(e),r&&v(e,function(e,r){return x(r,!0)})}}function A(){throw new Error("This object has been frozen and should not be mutated")}function S(){throw new Error("Illegal state, please file a bug")}var z=function(){function e(e,r){this.drafts=[],this.parent=e,this.immer=r,this.canAutoFreeze=!0}return e.prototype.usePatches=function(e){e&&(this.patches=[],this.inversePatches=[],this.patchListener=e)},e.prototype.revoke=function(){this.leave(),this.drafts.forEach(M),this.drafts=null},e.prototype.leave=function(){this===e.current&&(e.current=this.parent)},e.enter=function(r){var t=new e(e.current,r);return e.current=t,t},e}();function M(e){var r=e[u];r.type===n.ProxyObject||r.type===n.ProxyArray?r.revoke():r.revoked=!0}function k(e,r,t){var n=t.drafts[0],o=void 0!==r&&r!==n;if(e.willFinalize(t,r,o),o){if(n[u].modified)throw t.revoke(),new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");l(r)&&(r=D(e,r,t),t.parent||_(e,r)),t.patches&&(t.patches.push({op:"replace",path:[],value:r}),t.inversePatches.push({op:"replace",path:[],value:n[u].base}))}else r=D(e,n,t,[]);return t.revoke(),t.patches&&t.patchListener(t.patches,t.inversePatches),r!==c?r:void 0}function D(e,r,t,o){var a=r[u];if(!a)return Object.isFrozen(r)?r:F(e,r,t);if(a.scope!==t)return r;if(!a.modified)return _(e,a.base,!0),a.base;if(!a.finalized){if(a.finalized=!0,F(e,a.draft,t,o),e.onDelete&&a.type!==n.Set)if(e.useProxies){v(a.assigned,function(r,t){t||e.onDelete(a,r)})}else{var i=a.base,c=a.copy;v(i,function(r){m(c,r)||e.onDelete(a,r)})}e.onCopy&&e.onCopy(a),e.autoFreeze&&t.canAutoFreeze&&x(a.copy,!1),o&&t.patches&&function(e,r,t,o){switch(e.type){case n.ProxyObject:case n.ES5Object:case n.Map:return function(e,r,t,n){var o=e.base,a=e.copy;v(e.assigned,function(e,i){var c=g(o,e),s=g(a,e),u=i?m(o,e)?"replace":"add":"remove";if(c!==s||"replace"!==u){var f=r.concat(e);t.push("remove"===u?{op:u,path:f}:{op:u,path:f,value:s}),n.push("add"===u?{op:"remove",path:f}:"remove"===u?{op:"add",path:f,value:c}:{op:"replace",path:f,value:c})}})}(e,r,t,o);case n.ES5Array:case n.ProxyArray:return function(e,r,t,n){var o,a,i=e.base,c=e.assigned,s=e.copy;s||S();s.length<i.length&&(i=(o=[s,i])[0],s=o[1],t=(a=[n,t])[0],n=a[1]);var u=s.length-i.length,f=0;for(;i[f]===s[f]&&f<i.length;)++f;var p=i.length;for(;p>f&&i[p-1]===s[p+u-1];)--p;for(var d=f;d<p;++d)if(c[d]&&s[d]!==i[d]){var h=r.concat([d]);t.push({op:"replace",path:h,value:s[d]}),n.push({op:"replace",path:h,value:i[d]})}for(var l=t.length,d=p+u-1;d>=p;--d){var h=r.concat([d]);t[l+d-p]={op:"add",path:h,value:s[d]},n.push({op:"remove",path:h})}}(e,r,t,o);case n.Set:(function(e,r,t,n){var o=e.base,a=e.copy,i=0;o.forEach(function(e){if(!a.has(e)){var o=r.concat([i]);t.push({op:"remove",path:o,value:e}),n.unshift({op:"add",path:o,value:e})}i++}),i=0,a.forEach(function(e){if(!o.has(e)){var a=r.concat([i]);t.push({op:"add",path:a,value:e}),n.unshift({op:"remove",path:a,value:e})}i++})})(e,r,t,o)}}(a,o,t.patches,t.inversePatches)}return a.copy}function F(e,r,o,a){var i=r[u];return i&&(i.type!==n.ES5Object&&i.type!==n.ES5Array||(i.copy=E(i.draft,!0)),r=i.copy),v(r,function(n,c){return function e(r,n,o,a,i,c,s,u){if(s===i)throw Error("Immer forbids circular references");var f=!!a&&i===o;var p=O(i);if(h(s)){var d=u&&f&&!p&&!m(a.assigned,c)?u.concat(c):void 0;s=D(r,s,n,d),function(e,r,n){switch(b(e)){case t.Map:e.set(r,n);break;case t.Set:e.delete(r),e.add(n);break;default:e[r]=n}}(i,c,s),h(s)&&(n.canAutoFreeze=!1)}else{if(f&&P(s,g(a.base,c)))return;l(s)&&(v(s,function(t,i){return e(r,n,o,a,s,t,i,u)}),n.parent||_(r,s))}f&&r.onAssign&&!p&&r.onAssign(a,c,s)}(e,o,r,i,r,n,c,a)}),r}function _(e,r,t){void 0===t&&(t=!1),e.autoFreeze&&!h(r)&&x(r,t)}var C={get:function(e,r){if(r===u)return e;var t=e.drafts;if(!e.modified&&m(t,r))return t[r];var n=j(e)[r];if(e.finalized||!l(n))return n;if(e.modified){if(n!==N(e.base,r))return n;t=e.copy}return t[r]=e.scope.immer.createProxy(n,e)},has:function(e,r){return r in j(e)},ownKeys:function(e){return Reflect.ownKeys(j(e))},set:function(e,r,t){if(!e.modified){var n=N(e.base,r);if(t?P(n,t)||t===e.drafts[r]:P(n,t)&&r in e.base)return!0;W(e),R(e)}return e.assigned[r]=!0,e.copy[r]=t,!0},deleteProperty:function(e,r){return void 0!==N(e.base,r)||r in e.base?(e.assigned[r]=!1,W(e),R(e)):e.assigned[r]&&delete e.assigned[r],e.copy&&delete e.copy[r],!0},getOwnPropertyDescriptor:function(e,r){var t=j(e),o=Reflect.getOwnPropertyDescriptor(t,r);return o&&(o.writable=!0,o.configurable=e.type!==n.ProxyArray||"length"!==r),o},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},I={};function N(e,r){var t=e[u],n=Reflect.getOwnPropertyDescriptor(t?j(t):e,r);return n&&n.value}function R(e){if(!e.modified){if(e.modified=!0,e.type===n.ProxyObject||e.type===n.ProxyArray){var r=e.copy=E(e.base);v(e.drafts,function(e,t){r[e]=t}),e.drafts=void 0}e.parent&&R(e.parent)}}function W(e){e.copy||(e.copy=E(e.base))}function U(e,r,t){e.drafts.forEach(function(e){e[u].finalizing=!0}),t?h(r)&&r[u].scope===e&&B(e.drafts):(e.patches&&function e(r){if(!r||"object"!=typeof r)return;var t=r[u];if(!t)return;var o=t.base,a=t.draft,i=t.assigned,c=t.type;if(c===n.ES5Object)v(a,function(r){r!==u&&(void 0!==o[r]||m(o,r)?i[r]||e(a[r]):(i[r]=!0,L(t)))}),v(o,function(e){void 0!==a[e]||m(a,e)||(i[e]=!1,L(t))});else if(c===n.ES5Array){if(H(t)&&(L(t),i.length=!0),a.length<o.length)for(var s=a.length;s<o.length;s++)i[s]=!1;else for(var s=o.length;s<a.length;s++)i[s]=!0;for(var f=Math.min(a.length,o.length),s=0;s<f;s++)void 0===i[s]&&e(a[s])}}(e.drafts[0]),B(e.drafts))}function K(e,r){var t=Array.isArray(e),o=J(e);v(o,function(r){!function(e,r,t){var n=V[r];n?n.enumerable=t:V[r]=n={configurable:!0,enumerable:t,get:function(){return function(e,r){q(e);var t=T(j(e),r);if(e.finalizing)return t;if(t===T(e.base,r)&&l(t))return $(e),e.copy[r]=e.scope.immer.createProxy(t,e);return t}(this[u],r)},set:function(e){!function(e,r,t){if(q(e),e.assigned[r]=!0,!e.modified){if(P(t,T(j(e),r)))return;L(e),$(e)}e.copy[r]=t}(this[u],r,e)}};Object.defineProperty(e,r,n)}(o,r,t||function(e,r){var t=Object.getOwnPropertyDescriptor(e,r);return!(!t||!t.enumerable)}(e,r))});var a,i,c,s={type:t?n.ES5Array:n.ES5Object,scope:r?r.scope:z.current,modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:r,base:e,draft:o,copy:null,revoked:!1,isManual:!1};return a=o,i=u,c=s,Object.defineProperty(a,i,{value:c,enumerable:!1,writable:!0}),o}function T(e,r){var t=e[u];if(t&&!t.finalizing){t.finalizing=!0;var n=e[r];return t.finalizing=!1,n}return e[r]}function L(e){e.modified||(e.modified=!0,e.parent&&L(e.parent))}function $(e){e.copy||(e.copy=J(e.base))}function J(e){var r=e&&e[u];if(r){r.finalizing=!0;var t=E(r.draft,!0);return r.finalizing=!1,t}return E(e)}v(C,function(e,r){I[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}}),I.deleteProperty=function(e,r){if(isNaN(parseInt(r)))throw new Error("Immer only supports deleting array indices");return C.deleteProperty.call(this,e[0],r)},I.set=function(e,r,t){if("length"!==r&&isNaN(parseInt(r)))throw new Error("Immer only supports setting array indices and the 'length' property");return C.set.call(this,e[0],r,t,e[0])};var V={};function q(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(j(e)))}function B(e){for(var r=e.length-1;r>=0;r--){var t=e[r][u];if(!t.modified)switch(t.type){case n.ES5Array:H(t)&&L(t);break;case n.ES5Object:G(t)&&L(t)}}}function G(e){for(var r=e.base,t=e.draft,n=Object.keys(t),o=n.length-1;o>=0;o--){var a=n[o],i=r[a];if(void 0===i&&!m(r,a))return!0;var c=t[a],s=c&&c[u];if(s?s.base!==i:!P(c,i))return!0}return n.length!==Object.keys(r).length}function H(e){var r=e.draft;if(r.length!==e.base.length)return!0;var t=Object.getOwnPropertyDescriptor(r,r.length-1);return!(!t||t.get)}var Q=function(e){if(!e)throw new Error("Map is not polyfilled");function r(e,r){return this[u]={type:n.Map,parent:r,scope:r?r.scope:z.current,modified:!1,finalized:!1,copy:void 0,assigned:void 0,base:e,draft:this,isManual:!1,revoked:!1},this}d(r,e);var t=r.prototype;return Object.defineProperty(t,"size",{get:function(){return j(this[u]).size},enumerable:!0,configurable:!0}),t.has=function(e){return j(this[u]).has(e)},t.set=function(e,r){var t=this[u];return q(t),j(t).get(e)!==r&&(X(t),t.scope.immer.markChanged(t),t.assigned.set(e,!0),t.copy.set(e,r),t.assigned.set(e,!0)),this},t.delete=function(e){if(!this.has(e))return!1;var r=this[u];return q(r),X(r),r.scope.immer.markChanged(r),r.assigned.set(e,!1),r.copy.delete(e),!0},t.clear=function(){var e=this[u];return q(e),X(e),e.scope.immer.markChanged(e),e.assigned=new Map,e.copy.clear()},t.forEach=function(e,r){var t=this;j(this[u]).forEach(function(n,o,a){e.call(r,t.get(o),o,t)})},t.get=function(e){var r=this[u];q(r);var t=j(r).get(e);if(r.finalized||!l(t))return t;if(t!==r.base.get(e))return t;var n=r.scope.immer.createProxy(t,r);return X(r),r.copy.set(e,n),n},t.keys=function(){return j(this[u]).keys()},t.values=function(){var e,r=this,t=this.keys();return(e={})[f]=function(){return r.values()},e.next=function(){var e=t.next();return e.done?e:{done:!1,value:r.get(e.value)}},e},t.entries=function(){var e,r=this,t=this.keys();return(e={})[f]=function(){return r.entries()},e.next=function(){var e=t.next();if(e.done)return e;var n=r.get(e.value);return{done:!1,value:[e.value,n]}},e},t[f]=function(){return this.entries()},r}(Map);function X(e){e.copy||(e.assigned=new Map,e.copy=new Map(e.base))}var Y=function(e){if(!e)throw new Error("Set is not polyfilled");function r(e,r){return this[u]={type:n.Set,parent:r,scope:r?r.scope:z.current,modified:!1,finalized:!1,copy:void 0,base:e,draft:this,drafts:new Map,revoked:!1,isManual:!1},this}d(r,e);var t=r.prototype;return Object.defineProperty(t,"size",{get:function(){return j(this[u]).size},enumerable:!0,configurable:!0}),t.has=function(e){var r=this[u];return q(r),r.copy?!!r.copy.has(e)||!(!r.drafts.has(e)||!r.copy.has(r.drafts.get(e))):r.base.has(e)},t.add=function(e){var r=this[u];return q(r),r.copy?r.copy.add(e):r.base.has(e)||(Z(r),r.scope.immer.markChanged(r),r.copy.add(e)),this},t.delete=function(e){if(!this.has(e))return!1;var r=this[u];return q(r),Z(r),r.scope.immer.markChanged(r),r.copy.delete(e)||!!r.drafts.has(e)&&r.copy.delete(r.drafts.get(e))},t.clear=function(){var e=this[u];return q(e),Z(e),e.scope.immer.markChanged(e),e.copy.clear()},t.values=function(){var e=this[u];return q(e),Z(e),e.copy.values()},t.entries=function(){var e=this[u];return q(e),Z(e),e.copy.entries()},t.keys=function(){return this.values()},t[f]=function(){return this.values()},t.forEach=function(e,r){for(var t=this.values(),n=t.next();!n.done;)e.call(r,n.value,n.value,this),n=t.next()},r}(Set);function Z(e){e.copy||(e.copy=new Set,e.base.forEach(function(r){if(l(r)){var t=e.scope.immer.createProxy(r,e);e.drafts.set(r,t),e.copy.add(t)}else e.copy.add(r)}))}function ee(e,r){return r.forEach(function(r){var n=r.path,o=r.op;n.length||S();for(var a=e,i=0;i<n.length-1;i++)if(!(a=g(a,n[i]))||"object"!=typeof a)throw new Error("Cannot apply patch, path doesn't resolve: "+n.join("/"));var c=b(a),s=re(r.value),u=n[n.length-1];switch(o){case"replace":switch(c){case t.Map:return a.set(u,s);case t.Set:throw new Error('Sets cannot have "replace" patches.');default:return a[u]=s}case"add":switch(c){case t.Array:return a.splice(u,0,s);case t.Map:return a.set(u,s);case t.Set:return a.add(s);default:return a[u]=s}case"remove":switch(c){case t.Array:return a.splice(u,1);case t.Map:return a.delete(u);case t.Set:return a.delete(r.value);default:return delete a[u]}default:throw new Error("Unsupported patch operation: "+o)}}),e}function re(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(re);if(w(e))return new Map(Array.from(e.entries()).map(function(e){return[e[0],re(e[1])]}));if(O(e))return new Set(Array.from(e).map(re));var r=Object.create(Object.getPrototypeOf(e));for(var t in e)r[t]=re(e[t]);return r}function te(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;var n=Array(e),o=0;for(r=0;r<t;r++)for(var a=arguments[r],i=0,c=a.length;i<c;i++,o++)n[o]=a[i];return n}var ne={useProxies:"undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,autoFreeze:"undefined"!=typeof process?"production"!==process.env.NODE_ENV:"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},oe=function(){function e(e){var r=this;this.useProxies=!1,this.autoFreeze=!1,v(ne,function(t,n){var o,a;r[t]=null!=(a=null===(o=e)||void 0===o?void 0:o[t])?a:n}),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}return e.prototype.produce=function(e,r,t){var n,o=this;if("function"==typeof e&&"function"!=typeof r){var a=r;r=e;var i=this;return function(e){var t=arguments,n=this;void 0===e&&(e=a);for(var o=[],c=1;c<arguments.length;c++)o[c-1]=t[c];return i.produce(e,function(e){return r.call.apply(r,te([n,e],o))})}}if("function"!=typeof r)throw new Error("The first or second argument to `produce` must be a function");if(void 0!==t&&"function"!=typeof t)throw new Error("The third argument to `produce` must be a function or undefined");if(l(e)){var s=z.enter(this),u=this.createProxy(e,void 0),f=!0;try{n=r(u),f=!1}finally{f?s.revoke():s.leave()}return"undefined"!=typeof Promise&&n instanceof Promise?n.then(function(e){return s.usePatches(t),k(o,e,s)},function(e){throw s.revoke(),e}):(s.usePatches(t),k(this,n,s))}if((n=r(e))!==c)return void 0===n&&(n=e),_(this,n,!0),n},e.prototype.produceWithPatches=function(e,r,t){var n,o,a=this;return"function"==typeof e?function(r){for(var t=arguments,n=[],o=1;o<arguments.length;o++)n[o-1]=t[o];return a.produceWithPatches(r,function(r){return e.apply(void 0,te([r],n))})}:(t&&S(),[this.produce(e,r,function(e,r){n=e,o=r}),n,o])},e.prototype.createDraft=function(e){if(!l(e))throw new Error("First argument to `createDraft` must be a plain object, an array, or an immerable object");var r=z.enter(this),t=this.createProxy(e,void 0);return t[u].isManual=!0,r.leave(),t},e.prototype.finishDraft=function(e,r){var t=e&&e[u];if(!t||!t.isManual)throw new Error("First argument to `finishDraft` must be a draft returned by `createDraft`");if(t.finalized)throw new Error("The given draft is already finalized");var n=t.scope;return n.usePatches(r),k(this,void 0,n)},e.prototype.setAutoFreeze=function(e){this.autoFreeze=e},e.prototype.setUseProxies=function(e){this.useProxies=e},e.prototype.applyPatches=function(e,r){var t;for(t=r.length-1;t>=0;t--){var n=r[t];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}return h(e)?ee(e,r):this.produce(e,function(e){return ee(e,r.slice(t+1))})},e.prototype.createProxy=function(e,r){var t=w(e)?function(e,r){return new Q(e,r)}(e,r):O(e)?function(e,r){return new Y(e,r)}(e,r):this.useProxies?function(e,r){var t=Array.isArray(e),o={type:t?n.ProxyArray:n.ProxyObject,scope:r?r.scope:z.current,modified:!1,finalized:!1,assigned:{},parent:r,base:e,draft:null,drafts:{},copy:null,revoke:null,isManual:!1},a=o,i=C;t&&(a=[o],i=I);var c=Proxy.revocable(a,i),s=c.revoke,u=c.proxy;return o.draft=u,o.revoke=s,u}(e,r):K(e,r);return(r?r.scope:z.current).drafts.push(t),t},e.prototype.willFinalize=function(e,r,t){this.useProxies||U(e,r,t)},e.prototype.markChanged=function(e){this.useProxies?R(e):L(e)},e}(),ae=new oe,ie=ae.produce,ce=ae.produceWithPatches.bind(ae),se=ae.setAutoFreeze.bind(ae),ue=ae.setUseProxies.bind(ae),fe=ae.applyPatches.bind(ae),pe=ae.createDraft.bind(ae),de=ae.finishDraft.bind(ae);e.Immer=oe,e.applyPatches=fe,e.castDraft=function(e){return e},e.castImmutable=function(e){return e},e.createDraft=pe,e.default=ie,e.finishDraft=de,e.immerable=s,e.isDraft=h,e.isDraftable=l,e.nothing=c,e.original=function(e){if(e&&e[u])return e[u].base},e.produce=ie,e.produceWithPatches=ce,e.setAutoFreeze=se,e.setUseProxies=ue,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=immer.umd.js.map
