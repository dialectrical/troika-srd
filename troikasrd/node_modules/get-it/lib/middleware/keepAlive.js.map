{"version":3,"sources":["../../src/middleware/keepAlive.js"],"names":["http","require","https","objectAssign","isHttpsProto","module","exports","config","ms","maxFree","agentOptions","keepAlive","keepAliveMsecs","maxFreeSockets","httpAgent","Agent","httpsAgent","agents","finalizeOptions","options","agent","isHttps","test","href","protocol","keepOpts","maxRedirects"],"mappings":";;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,QAAQD,QAAQ,OAAR,CAAd;AACA,IAAME,eAAeF,QAAQ,eAAR,CAArB;;AAEA,IAAMG,eAAe,UAArB;;AAEAC,OAAOC,OAAP,GAAiB,YAAiB;AAAA,MAAhBC,MAAgB,uEAAP,EAAO;;AAChC,MAAMC,KAAKD,OAAOC,EAAP,IAAa,IAAxB;AACA,MAAMC,UAAUF,OAAOE,OAAP,IAAkB,GAAlC;AACA,MAAMC,eAAe,EAACC,WAAW,IAAZ,EAAkBC,gBAAgBJ,EAAlC,EAAsCK,gBAAgBJ,OAAtD,EAArB;AACA,MAAMK,YAAY,IAAId,KAAKe,KAAT,CAAeL,YAAf,CAAlB;AACA,MAAMM,aAAa,IAAId,MAAMa,KAAV,CAAgBL,YAAhB,CAAnB;AACA,MAAMO,SAAS,EAACjB,MAAMc,SAAP,EAAkBZ,OAAOc,UAAzB,EAAf;;AAEA,SAAO;AACLE,qBAAiB,kCAAW;AAC1B,UAAIC,QAAQC,KAAZ,EAAmB;AACjB,eAAOD,OAAP;AACD;;AAED,UAAME,UAAUjB,aAAakB,IAAb,CAAkBH,QAAQI,IAAR,IAAgBJ,QAAQK,QAA1C,CAAhB;AACA,UAAMC,WACJN,QAAQO,YAAR,KAAyB,CAAzB,GAA6B,EAACN,OAAOC,UAAUL,UAAV,GAAuBF,SAA/B,EAA7B,GAAyE,EAACG,cAAD,EAD3E;;AAGA,aAAOd,aAAa,EAAb,EAAiBgB,OAAjB,EAA0BM,QAA1B,CAAP;AACD;AAXI,GAAP;AAaD,CArBD","file":"keepAlive.js","sourcesContent":["const http = require('http')\nconst https = require('https')\nconst objectAssign = require('object-assign')\n\nconst isHttpsProto = /^https:/i\n\nmodule.exports = (config = {}) => {\n  const ms = config.ms || 1000\n  const maxFree = config.maxFree || 256\n  const agentOptions = {keepAlive: true, keepAliveMsecs: ms, maxFreeSockets: maxFree}\n  const httpAgent = new http.Agent(agentOptions)\n  const httpsAgent = new https.Agent(agentOptions)\n  const agents = {http: httpAgent, https: httpsAgent}\n\n  return {\n    finalizeOptions: options => {\n      if (options.agent) {\n        return options\n      }\n\n      const isHttps = isHttpsProto.test(options.href || options.protocol)\n      const keepOpts =\n        options.maxRedirects === 0 ? {agent: isHttps ? httpsAgent : httpAgent} : {agents}\n\n      return objectAssign({}, options, keepOpts)\n    }\n  }\n}\n"]}