{"version":3,"sources":["../../../src/middleware/progress/browser-progress.js"],"names":["module","exports","onRequest","evt","adapter","xhr","request","context","upload","onprogress","handleProgress","stage","percent","event","lengthComputable","loaded","total","channels","progress","publish"],"mappings":";;AAAAA,OAAOC,OAAP,GAAiB;AAAA,SAAO;AACtBC,eAAW,wBAAO;AAChB,UAAIC,IAAIC,OAAJ,KAAgB,KAApB,EAA2B;AACzB;AACD;;AAED,UAAMC,MAAMF,IAAIG,OAAhB;AACA,UAAMC,UAAUJ,IAAII,OAApB;;AAEA,UAAI,YAAYF,GAAZ,IAAmB,gBAAgBA,IAAIG,MAA3C,EAAmD;AACjDH,YAAIG,MAAJ,CAAWC,UAAX,GAAwBC,eAAe,QAAf,CAAxB;AACD;;AAED,UAAI,gBAAgBL,GAApB,EAAyB;AACvBA,YAAII,UAAJ,GAAiBC,eAAe,UAAf,CAAjB;AACD;;AAED,eAASA,cAAT,CAAwBC,KAAxB,EAA+B;AAC7B,eAAO,iBAAS;AACd,cAAMC,UAAUC,MAAMC,gBAAN,GAA0BD,MAAME,MAAN,GAAeF,MAAMG,KAAtB,GAA+B,GAAxD,GAA8D,CAAC,CAA/E;AACAT,kBAAQU,QAAR,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkC;AAChCR,wBADgC;AAEhCC,4BAFgC;AAGhCI,mBAAOH,MAAMG,KAHmB;AAIhCD,oBAAQF,MAAME,MAJkB;AAKhCD,8BAAkBD,MAAMC;AALQ,WAAlC;AAOD,SATD;AAUD;AACF;AA7BqB,GAAP;AAAA,CAAjB","file":"browser-progress.js","sourcesContent":["module.exports = () => ({\n  onRequest: evt => {\n    if (evt.adapter !== 'xhr') {\n      return\n    }\n\n    const xhr = evt.request\n    const context = evt.context\n\n    if ('upload' in xhr && 'onprogress' in xhr.upload) {\n      xhr.upload.onprogress = handleProgress('upload')\n    }\n\n    if ('onprogress' in xhr) {\n      xhr.onprogress = handleProgress('download')\n    }\n\n    function handleProgress(stage) {\n      return event => {\n        const percent = event.lengthComputable ? (event.loaded / event.total) * 100 : -1\n        context.channels.progress.publish({\n          stage,\n          percent,\n          total: event.total,\n          loaded: event.loaded,\n          lengthComputable: event.lengthComputable\n        })\n      }\n    }\n  }\n})\n"]}