{"version":3,"sources":["../../src/middleware/observable.js"],"names":["global","require","objectAssign","module","exports","opts","Observable","implementation","Error","onReturn","channels","context","error","subscribe","observer","err","progress","next","type","event","response","complete","request","publish","abort"],"mappings":";;AAAA,IAAMA,SAASC,QAAQ,gBAAR,CAAf;AACA,IAAMC,eAAeD,QAAQ,eAAR,CAArB;;AAEAE,OAAOC,OAAP,GAAiB,YAAe;AAAA,MAAdC,IAAc,uEAAP,EAAO;;AAC9B,MAAMC,aAAaD,KAAKE,cAAL,IAAuBP,OAAOM,UAAjD;AACA,MAAI,CAACA,UAAL,EAAiB;AACf,UAAM,IAAIE,KAAJ,CACJ,iFADI,CAAN;AAGD;;AAED,SAAO;AACLC,cAAU,kBAACC,QAAD,EAAWC,OAAX;AAAA,aACR,IAAIL,UAAJ,CAAe,oBAAY;AACzBI,iBAASE,KAAT,CAAeC,SAAf,CAAyB;AAAA,iBAAOC,SAASF,KAAT,CAAeG,GAAf,CAAP;AAAA,SAAzB;AACAL,iBAASM,QAAT,CAAkBH,SAAlB,CAA4B;AAAA,iBAASC,SAASG,IAAT,CAAcf,aAAa,EAACgB,MAAM,UAAP,EAAb,EAAiCC,KAAjC,CAAd,CAAT;AAAA,SAA5B;AACAT,iBAASU,QAAT,CAAkBP,SAAlB,CAA4B,oBAAY;AACtCC,mBAASG,IAAT,CAAcf,aAAa,EAACgB,MAAM,UAAP,EAAb,EAAiCE,QAAjC,CAAd;AACAN,mBAASO,QAAT;AACD,SAHD;;AAKAX,iBAASY,OAAT,CAAiBC,OAAjB,CAAyBZ,OAAzB;AACA,eAAO;AAAA,iBAAMD,SAASc,KAAT,CAAeD,OAAf,EAAN;AAAA,SAAP;AACD,OAVD,CADQ;AAAA;AADL,GAAP;AAcD,CAtBD","file":"observable.js","sourcesContent":["const global = require('../util/global')\nconst objectAssign = require('object-assign')\n\nmodule.exports = (opts = {}) => {\n  const Observable = opts.implementation || global.Observable\n  if (!Observable) {\n    throw new Error(\n      '`Observable` is not available in global scope, and no implementation was passed'\n    )\n  }\n\n  return {\n    onReturn: (channels, context) =>\n      new Observable(observer => {\n        channels.error.subscribe(err => observer.error(err))\n        channels.progress.subscribe(event => observer.next(objectAssign({type: 'progress'}, event)))\n        channels.response.subscribe(response => {\n          observer.next(objectAssign({type: 'response'}, response))\n          observer.complete()\n        })\n\n        channels.request.publish(context)\n        return () => channels.abort.publish()\n      })\n  }\n}\n"]}